require: slotfilling/slotFilling.sc
  module = sys.zb-common

theme: /

    state: Start
        intent: /–ø—Ä–∏–≤–µ—Ç
        q!: $regex</start>
        random: 
            a: –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ú–µ–Ω—è –∑–æ–≤—É—Ç –ê—Ä—Ç—É—Ä, –±–æ—Ç-–ø–æ–º–æ—â–Ω–∏–∫ –∫–æ–º–ø–∞–Ω–∏–∏ Just Tour. –†–∞—Å—Å–∫–∞–∂—É –≤—Å–µ –æ –ø–æ–≥–æ–¥–µ –≤ –≥–æ—Ä–æ–¥–∞—Ö –º–∏—Ä–∞ –∏ –ø–æ–º–æ–≥—É —Å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º –∑–∞—è–≤–∫–∏ –Ω–∞ –ø–æ–¥–±–æ—Ä —Ç—É—Ä–∞.
            a: –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é –≤–∞—Å! –Ø –ê—Ä—Ç—É—Ä, —Ä–∞–±–æ—Ç–∞—é –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º –≤ Just Tour, –ª—É—á—à–µ–º —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–æ–º –∞–≥–µ–Ω—Ç—Å—Ç–≤–µ. –ü—Ä–æ–∏–Ω—Ñ–æ—Ä–º–∏—Ä—É—é –≤–∞—Å –æ –ø–æ–≥–æ–¥–µ –≤ —Ä–∞–∑–Ω—ã—Ö –≥–æ—Ä–æ–¥–∞—Ö –∏ —Å–æ–±–µ—Ä—É –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –ø–æ–¥–±–æ—Ä –ø—É—Ç–µ–≤–∫–∏.
        go!: /HowCanIHelpYou

    state: HowCanIHelpYou
        random: 
            a: –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?
            a: –ß—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?
            a: –ü–æ–¥—Å–∫–∞–∂–∏—Ç–µ, –∫–∞–∫–æ–π —É –≤–∞—Å –≤–æ–ø—Ä–æ—Å?
        buttons:
            "–ü—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã" -> /WeatherForecast
            "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞—è–≤–∫—É" -> /TravelRequest
        q: * (–Ω–µ—Ç/–Ω–µ –∑–Ω–∞—é/–Ω–µ —Å–µ–π—á–∞—Å/–ø–æ–∫–∞ –Ω–µ—Ç/–≤–æ–ø—Ä–æ—Å–æ–≤ –Ω–µ—Ç) * || toState = "/DontHaveQuestions"

        state: CatchAll
            event: noMatch
            script:
                $session.catchAllCounter = ($session.catchAllCounter || 0) + 1;
            
            if: $session.catchAllCounter < 3
                random: 
                    a: –ò–∑–≤–∏–Ω–∏—Ç–µ, –Ω–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è–ª. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥—Å–∫–∞–∂–∏—Ç–µ, –º–æ–≥—É –ª–∏ —è —á–µ–º-—Ç–æ –≤–∞–º –ø–æ–º–æ—á—å?
                    a: –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–µ —Å–º–æ–≥ –ø–æ–Ω—è—Ç—å, —á—Ç–æ –≤—ã –∏–º–µ–µ—Ç–µ –≤ –≤–∏–¥—É. –ü–æ–¥—Å–∫–∞–∂–∏—Ç–µ, —á—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?
                go!: /HowCanIHelpYou
            else: 
                a: –ö–∞–∂–µ—Ç—Å—è, —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å –Ω–µ –≤ –º–æ–µ–π –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏. –ù–æ —è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —É—á—É—Å—å –Ω–æ–≤–æ–º—É, –∏, –Ω–∞–¥–µ—é—Å—å, —Å–æ–≤—Å–µ–º —Å–∫–æ—Ä–æ –Ω–∞—É—á—É—Å—å –æ—Ç–≤–µ—á–∞—Ç—å –∏ –Ω–∞ –Ω–µ–≥–æ.
                script:
                    $session.catchAllCounter = 0;
                go!: /SomethingElse

    state: DontHaveQuestions
        a: –•–æ—Ä–æ—à–æ! –ï—Å–ª–∏ –±—É–¥—É—Ç –≤–æ–ø—Ä–æ—Å—ã - –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å!
        go!: /Goodbye

    state: SomethingElse
        random: 
            a: –•–æ—Ç–∏—Ç–µ —Å–ø—Ä–æ—Å–∏—Ç—å —á—Ç–æ-—Ç–æ –µ—â–µ?
            a: –ú–æ–≥—É –ª–∏ —è –ø–æ–º–æ—á—å —á–µ–º-—Ç–æ –µ—â–µ?
            a: –ü–æ–¥—Å–∫–∞–∂–∏—Ç–µ, —É –≤–∞—Å –æ—Å—Ç–∞–ª–∏—Å—å –µ—â–µ –≤–æ–ø—Ä–æ—Å—ã?
        buttons:
            "–£–∑–Ω–∞—Ç—å –ø—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã" -> /WeatherForecast
            "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ —Ç—É—Ä" -> /TravelRequest
        q: –¥–∞ || onlyThisState = true, toState = "/HowCanIHelpYou"
        q: –Ω–µ—Ç || onlyThisState = true, toState = "/DontHaveQuestions"

        state: CatchAll
            event: noMatch
            script:
                $session.somethingElseCounter = ($session.somethingElseCounter || 0) + 1;
            
            if: $session.somethingElseCounter < 3
                random:
                    a: –ò–∑–≤–∏–Ω–∏—Ç–µ, –Ω–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è–ª. –£—Ç–æ—á–Ω–∏—Ç–µ, —á—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?
                    a: –ù–µ —Å–º–æ–≥ —Ä–∞–∑–æ–±—Ä–∞—Ç—å –≤–∞—à –æ—Ç–≤–µ—Ç. –í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:
                buttons:
                    "–ü–æ–≥–æ–¥–∞" -> /WeatherForecast
                    "–¢—É—Ä" -> /TravelRequest
                go!: /SomethingElse
            else:
                a: –ü—Ä–æ—Å—Ç–∏—Ç–µ, —Ç–∞–∫ –∏ –Ω–µ —Å–º–æ–≥ –ø–æ–Ω—è—Ç—å, —á—Ç–æ –≤—ã –∏–º–µ–ª–∏ –≤ –≤–∏–¥—É.
                script:
                    $session.somethingElseCounter = 0;
                go!: /Goodbye
        
    state: Goodbye
        intent: /–ø–æ–∫–∞
        random: 
            a: –í—Å–µ–≥–æ –¥–æ–±—Ä–æ–≥–æ!
            a: –í—Å–µ–≥–æ –≤–∞–º –¥–æ–±—Ä–æ–≥–æ!
            a: –í—Å–µ–≥–æ –¥–æ–±—Ä–æ–≥–æ, –¥–æ —Å–≤–∏–¥–∞–Ω–∏—è!
        script:
            $reactions.transition("/")

    # state: WeatherForecast
    #     a: –≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
    #     go!: /SomethingElse
        
    state: WeatherForecast
        intent!: /–ø–æ–≥–æ–¥–∞|–ø—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã|–∫–∞–∫–∞—è –ø–æ–≥–æ–¥–∞/
        a: –í –∫–∞–∫–æ–º –≥–æ—Ä–æ–¥–µ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç –ø–æ–≥–æ–¥–∞?
    
        state: City
            q: * @City *
            # script:
            #     var city = $parseTree._City;
            #     var apiKey = "–í–ê–®_API_–ö–õ–Æ–ß"; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –∫–ª—é—á
            #     var url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric&lang=ru`;
                
            #     try {
            #         var response = $http.get(url);
            #         if (response && response.data) {
            #             var weatherData = response.data;
            #             var temp = weatherData.main.temp;
            #             var feelsLike = weatherData.main.feels_like;
            #             var description = weatherData.weather[0].description;
            #             var windSpeed = weatherData.wind.speed;
                        
            #             $reactions.answer(`–ü–æ–≥–æ–¥–∞ –≤ ${city}:\nüå° –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${temp}¬∞C (–æ—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫ ${feelsLike}¬∞C)\n‚òÅÔ∏è –û–ø–∏—Å–∞–Ω–∏–µ: ${description}\nüå¨ –í–µ—Ç–µ—Ä: ${windSpeed} –º/—Å`);
            #         } else {
            #             $reactions.answer("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≥–æ–¥–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.");
            #         }
            #     } catch (e) {
            #         $reactions.answer("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –ø–æ–≥–æ–¥—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É—Ç–æ—á–Ω–∏—Ç—å –≥–æ—Ä–æ–¥.");
            #     }
            go!: /SomethingElse

    state: NoCity
        event: noMatch
        a: –ò–∑–≤–∏–Ω–∏—Ç–µ, –Ω–µ –Ω–∞—à–µ–ª —Ç–∞–∫–æ–≥–æ –≥–æ—Ä–æ–¥–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.
        go!: ../City

    state: TravelRequest
        a: –≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
        go!: /SomethingElse
        
    state: GlobalCatchAll
        event!: noMatch
        script:
            $session.globalCounter = ($session.globalCounter || 0) + 1;
        
        if: $session.globalCounter < 3
            random:
                a: –ü—Ä–æ—à—É –ø—Ä–æ—â–µ–Ω–∏—è, –Ω–µ —Å–æ–≤—Å–µ–º –≤–∞—Å –ø–æ–Ω—è–ª. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –≤–∞—à –≤–æ–ø—Ä–æ—Å.
                a: –ü—Ä–æ—Å—Ç–∏—Ç–µ, –Ω–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è–ª. –ß—Ç–æ –∏–º–µ–Ω–Ω–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?
                a: –ü—Ä–æ—Å—Ç–∏—Ç–µ, –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å –≤–∞—Å –ø–æ–Ω—è—Ç—å. –ü–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞.
                a: –ù–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è–ª –≤–∞—Å. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –ø–æ-–¥—Ä—É–≥–æ–º—É.
            go!: /HowCanIHelpYou
        else:
            a: –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —è –Ω–µ —Å–º–æ–≥ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤–∞—à –∑–∞–ø—Ä–æ—Å. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.
            script:
                $session.globalCounter = 0;
            go!: /SomethingElse

    state: AreYouRobot
        intent!: /—Ç—ã —Ä–æ–±–æ—Ç
        random: 
            a: –Ø –ê—Ä—Ç—É—Ä ‚Äî –±–æ—Ç-–ø–æ–º–æ—â–Ω–∏–∫ –∫–æ–º–ø–∞–Ω–∏–∏ Just Tour, –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã.
            a: –í—ã –æ–±—â–∞–µ—Ç–µ—Å—å —Å –ê—Ä—Ç—É—Ä–æ–º ‚Äî —á–∞—Ç-–±–æ—Ç–æ–º, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–º –∫–æ–º–∞–Ω–¥–æ–π Just Tour, —á—Ç–æ–±—ã –ø–æ–º–æ–≥–∞—Ç—å –≤–∞–º. –í—Å–µ–≥–¥–∞ —Ä–∞–¥ –ø–æ–æ–±—â–∞—Ç—å—Å—è —Å –≤–∞–º–∏!
        go!: /HowCanIHelpYou

    state: WhatCanYouDo
        intent!: /—á—Ç–æ —Ç—ã —É–º–µ–µ—à—å|—Ç–≤–æ–∏ —Ñ—É–Ω–∫—Ü–∏–∏|–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏/
        random:
            a: –£–º–µ—é —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—Ç—å –æ –ø–æ–≥–æ–¥–µ –≤ –≥–æ—Ä–æ–¥–∞—Ö –º–∏—Ä–∞ –∏ —Å–æ—Å—Ç–∞–≤–ª—è—Ç—å –∑–∞—è–≤–∫–∏ –Ω–∞ –ø–æ–¥–±–æ—Ä –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –∏–º–µ–Ω–Ω–æ –≤–∞–º –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è.
            a: –° —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º —Ä–∞—Å—Å–∫–∞–∂—É –≤–∞–º –æ –±–ª–∏–∂–∞–π—à–∏—Ö –º–µ—Ç–µ–æ–ø—Ä–æ–≥–Ω–æ–∑–∞—Ö –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ –∏ –ø–æ–º–æ–≥—É —Å–æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–¥–±–æ—Ä —Ç—É—Ä–∞.
        go!: /HowCanIHelpYou

    state: AnyError
        event!: error
        random:
            a: –ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞. –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏–∑—É—á–∞—Ç –µ–µ –∏ –≤–æ–∑—å–º—É—Ç –≤ —Ä–∞–±–æ—Ç—É. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–ø–∏—à–∏—Ç–µ –≤ —á–∞—Ç –ø–æ–∑–∂–µ.
            a: –ü—Ä–æ—Å—Ç–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –≤ —Å–∏—Å—Ç–µ–º–µ. –ù–∞—à–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –µ–µ –∏—Å–ø—Ä–∞–≤—è—Ç. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–ø–∏—à–∏—Ç–µ –º–Ω–µ –ø–æ–∑–∂–µ.
        buttons:
            "–í –Ω–∞—á–∞–ª–æ" -> /Start
        script:
            $reactions.transition("/")